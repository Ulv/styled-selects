/*!
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 *
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */
(function(d,f){var e="selectbox",c=false,b=true;function a(){this._state=[];this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:function(){console.log("ch")},onOpen:null,onClose:null}}d.extend(a.prototype,{_isOpenSelectbox:function(h){if(!h){return c}var g=this._getInst(h);return g.isOpen},_isDisabledSelectbox:function(h){if(!h){return c}var g=this._getInst(h);return g.isDisabled},_attachSelectbox:function(o,k){if(this._getInst(o)){return c}var j=d(o),v=this,m=v._newInst(j),l,r,i,p,w=c,u=j.find("optgroup"),h=j.find("option"),n=h.length,t=d(o).attr("data-placeholder");j.attr("sb",m.uid);d.extend(m.settings,v._defaults,k);v._state[m.uid]=c;j.hide();function g(){var x,y,s=this.attr("id").split("_")[1];for(x in v._state){if(x!==s){if(v._state.hasOwnProperty(x)){y=d("select[sb='"+x+"']")[0];if(y){v._closeSelectbox(y)}}}}}l=d("<div>",{id:"sbHolder_"+m.uid,"class":m.settings.classHolder,tabindex:j.attr("tabindex")});r=d("<a>",{id:"sbSelector_"+m.uid,href:"#","class":m.settings.classSelector,click:function(x){x.preventDefault();g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(v._state[s]){v._closeSelectbox(o)}else{v._openSelectbox(o)}d(".sbHolder").removeClass("sel_active");d(this).parent().addClass("sel_active")}});i=d("<a>",{id:"sbToggle_"+m.uid,href:"#","class":m.settings.classToggle,click:function(x){x.preventDefault();g.apply(d(this),[]);var s=d(this).attr("id").split("_")[1];if(v._state[s]){v._closeSelectbox(o)}else{v._openSelectbox(o)}}});i.appendTo(l);p=d("<ul>",{id:"sbOptions_"+m.uid,"class":m.settings.classOptions,css:{display:"none"}});j.children().each(function(y){var z=d(this),s,x={};if(z.is("option")){q(z)}else{if(z.is("optgroup")){s=d("<li>");d("<span>",{text:z.attr("label")}).addClass(m.settings.classGroup).appendTo(s);s.appendTo(p);if(z.is(":disabled")){x.disabled=true}x.sub=true;q(z.find("option"),x)}}});function q(){var x=arguments[1]&&arguments[1].sub?true:false,s=arguments[1]&&arguments[1].disabled?true:false;arguments[0].each(function(z){var A=d(this),y=d("<li>"),B;if(A.is(":selected")){r.text(A.text());w=b}if(z===n-1){y.addClass("last")}if(!A.is(":disabled")&&!s){B=d("<a>",{href:"#"+A.val(),rel:A.val()}).text(A.text()).bind("click.sb",function(F){if(F&&F.preventDefault){F.preventDefault()}var D=i,E=d(this),C=D.attr("id").split("_")[1];v._changeSelectbox(o,E.attr("rel"),E.text());v._closeSelectbox(o)}).bind("mouseover.sb",function(){var C=d(this);C.parent().siblings().find("a").removeClass(m.settings.classFocus);C.addClass(m.settings.classFocus)}).bind("mouseout.sb",function(){d(this).removeClass(m.settings.classFocus)});if(x){B.addClass(m.settings.classSub)}if(A.is(":selected")){B.addClass(m.settings.classFocus)}B.appendTo(y)}else{B=d("<span>",{text:A.text()}).addClass(m.settings.classDisabled);if(x){B.addClass(m.settings.classSub)}B.appendTo(y)}y.appendTo(p)})}r.text(t);d.data(o,e,m);l.data("uid",m.uid).bind("keydown.sb",function(B){var E=B.charCode?B.charCode:B.keyCode?B.keyCode:0,D=d(this),A=D.data("uid"),z=D.siblings("select[sb='"+A+"']").data(e),C=D.siblings(["select[sb='",A,"']"].join("")).get(0),s=D.find("ul").find("a."+z.settings.classFocus);switch(E){case 37:case 38:if(s.length>0){var x;d("a",D).removeClass(z.settings.classFocus);x=s.parent().prevAll("li:has(a)").eq(0).find("a");if(x.length>0){x.addClass(z.settings.classFocus).focus();d("#sbSelector_"+A).text(x.text())}}break;case 39:case 40:var x;d("a",D).removeClass(z.settings.classFocus);if(s.length>0){x=s.parent().nextAll("li:has(a)").eq(0).find("a")}else{x=D.find("ul").find("a").eq(0)}if(x.length>0){x.addClass(z.settings.classFocus).focus();d("#sbSelector_"+A).text(x.text())}break;case 13:if(s.length>0){v._changeSelectbox(C,s.attr("rel"),s.text())}v._closeSelectbox(C);break;case 9:if(C){var z=v._getInst(C);if(z){if(s.length>0){v._changeSelectbox(C,s.attr("rel"),s.text())}v._closeSelectbox(C)}}var y=parseInt(D.attr("tabindex"),10);if(!B.shiftKey){y++}else{y--}d("*[tabindex='"+y+"']").focus();break;case 27:v._closeSelectbox(C);break}B.stopPropagation();return false}).delegate("a","mouseover",function(s){d(this).addClass(m.settings.classFocus)}).delegate("a","mouseout",function(s){d(this).removeClass(m.settings.classFocus)});r.appendTo(l);p.appendTo(l);l.insertAfter(j);d("html").live("mousedown",function(s){s.stopPropagation();d("select").selectbox("close");d(".sbHolder").removeClass("sel_active")});d([".",m.settings.classHolder,", .",m.settings.classSelector].join("")).mousedown(function(s){s.stopPropagation()})},_detachSelectbox:function(h){var g=this._getInst(h);if(!g){return c}d("#sbHolder_"+g.uid).remove();d.data(h,e,null);d(h).show()},_changeSelectbox:function(j,i,k){var g,h=this._getInst(j);if(h){g=this._get(h,"onChange");d("#sbSelector_"+h.uid).text(k)}i=i.replace(/\'/g,"\\'");d(j).find("option[value='"+i+"']").attr("selected",b);if(h&&g){g.apply((h.input?h.input[0]:null),[i,h])}else{if(h&&h.input){h.input.trigger("change")}}},_enableSelectbox:function(h){var g=this._getInst(h);if(!g||!g.isDisabled){return c}d("#sbHolder_"+g.uid).removeClass(g.settings.classHolderDisabled);g.isDisabled=c;d.data(h,e,g)},_disableSelectbox:function(h){var g=this._getInst(h);if(!g||g.isDisabled){return c}d("#sbHolder_"+g.uid).addClass(g.settings.classHolderDisabled);g.isDisabled=b;d.data(h,e,g)},_optionSelectbox:function(j,g,i){var h=this._getInst(j);if(!h){return c}h[g]=i;d.data(j,e,h)},_openSelectbox:function(m){var k=this._getInst(m);if(!k||k.isOpen||k.isDisabled){return}var h=d("#sbOptions_"+k.uid),l=parseInt(d(window).height(),10),j=d("#sbHolder_"+k.uid).offset(),g=d(window).scrollTop(),o=h.prev().height(),n=l-(j.top-g)-o/2,i=this._get(k,"onOpen");h.css({top:o+"px",maxHeight:(n-o)+"px"});k.settings.effect==="fade"?h.fadeIn(k.settings.speed):h.slideDown(k.settings.speed);d("#sbToggle_"+k.uid).addClass(k.settings.classToggleOpen);this._state[k.uid]=b;k.isOpen=b;if(i){i.apply((k.input?k.input[0]:null),[k])}d.data(m,e,k)},_closeSelectbox:function(i){var h=this._getInst(i);if(!h||!h.isOpen){return}var g=this._get(h,"onClose");h.settings.effect==="fade"?d("#sbOptions_"+h.uid).fadeOut(h.settings.speed):d("#sbOptions_"+h.uid).slideUp(h.settings.speed);d("#sbToggle_"+h.uid).removeClass(h.settings.classToggleOpen);this._state[h.uid]=c;h.isOpen=c;if(g){g.apply((h.input?h.input[0]:null),[h])}d.data(i,e,h)},_newInst:function(g){var h=g[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:h,input:g,uid:Math.floor(Math.random()*99999999),isOpen:c,isDisabled:c,settings:{}}},_getInst:function(h){try{return d.data(h,e)}catch(g){throw"Missing instance data for this selectbox"}},_get:function(h,g){return h.settings[g]!==f?h.settings[g]:this._defaults[g]}});d.fn.selectbox=function(h){var g=Array.prototype.slice.call(arguments,1);if(typeof h=="string"&&h=="isDisabled"){return d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this[0]].concat(g))}if(h=="option"&&arguments.length==2&&typeof arguments[1]=="string"){return d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this[0]].concat(g))}return this.each(function(){typeof h=="string"?d.selectbox["_"+h+"Selectbox"].apply(d.selectbox,[this].concat(g)):d.selectbox._attachSelectbox(this,h)})};d.selectbox=new a();d.selectbox.version="0.2"})(jQuery);
